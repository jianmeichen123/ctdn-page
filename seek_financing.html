<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>投融快讯</title>
	<!--basis-->
	{(dn_basis.html)}
</head>

<body>
{(header.html)}
<div class="container">

	<form  action="#" id="form" enctype="multipart/form-data">
		<div class="seek_financing">
			<div class="seek_financing_tit">提交项目</div>
			<ul>
				<li>
					<div class="seek_financing_l"><span class="seek_financing_two">项目名称</span><span class="seek_financing_one">*</span></div>
					<div class="seek_financing_r">
						<input class="seek_financing_input" name="projName"  required data-rule-length20="true"  maxlength="20"  data-msg-length20="<span class='dn_ico dn_ico_error'></span>不超过20个字"  placeholder="请输入公司核心产品名称，不超过20个字">
					</div>
				</li>
				<li>
					<div class="seek_financing_l"><span class="seek_financing_two">所在地区</span><span class="seek_financing_one">*</span></div>
					<div class="seek_financing_r">
						<select class="seek_financing_select" name="projDistrictId" data-item="parent" data-field="district"  data-rule-select="true" data-msg-select="<font color=red>*</font>必选字段" >
							<option  selected = "selected" disabled="true">选择所在省/市</option>
						</select>
						<select class="seek_financing_select  seek_financing_select_lef" data-item="son" name="projSubDistrictId" data-rule-select="true" data-msg-select="<font color=red>*</font>必选字段" >
							<option selected= "selected" disabled="true">选择所在市/区</option>
						</select>
					</div>
					<input type="hidden" name="projDistrict">
					<input type="hidden" name="projSubDistrict">
				</li>
				<li>
					<div class="seek_financing_l"><span class="seek_financing_two">项目介绍</span><span class="seek_financing_one">*</span></div>
					<div class="seek_financing_r">
						<textarea class="seek_financing_textarea" name="projDesc" required maxlength="1000" placeholder="产品描述、用户群体、项目愿景、竞争对手等方面详细描述，不超过1000个字"  required data-rule-length1000="true" data-msg-length1000="<span class='dn_ico dn_ico_error'></span>不超过1000个字"></textarea>
					</div>
				</li>
				<li>
					<div class="seek_financing_l"><span class="seek_financing_two">联系人姓名</span><span class="seek_financing_one">*</span></div>
					<div class="seek_financing_r">
						<input class="seek_financing_input" name="projLinkman" required  maxlength="50"  placeholder="联系人姓名"  required data-rule-length50="true" data-msg-length50="<span class='dn_ico dn_ico_error'></span>不超过50个字">
					</div>
				</li>
				<li>
					<div class="seek_financing_l"><span class="seek_financing_two">联系人电话</span><span class="seek_financing_one">*</span></div>
					<div class="seek_financing_r">
						<input class="seek_financing_input" name="projLinktel" required  data-rule-phone="true"   maxlength="40" placeholder="联系人电话"  data-msg-phone="<span class='dn_ico dn_ico_error'></span>联系电话格式不正确">
					</div>
				</li>
				<li>
					<div class="seek_financing_l"><span class="seek_financing_two">商业计划书</span><span class="seek_financing_one">*</span></div>
					<div class="seek_financing_r">

						<div class="seek_put">
							<div class="logo_posi"><input type="file" name="file" id="projPb" style="opacity: 0;"/>
								<input type="hidden" name="projPb">
							</div>
							<span class="dn_ico dn_ico_seek_pur1"></span>上传文件

						</div>
						<span class="tit_span" id="projPbName">上传商业计划书，文件大小请限制在25M之内</span>
					</div>
				</li>

				<li class="seek_show_on">
					<div class="seek_financing_l"><span class="seek_financing_two">项目LOGO</span></div>
					<div class="seek_financing_r">
						<div class="seek_put">
							<div class="logo_posi"><input type="file" name="file" id="projLogo" style="opacity: 0;">
								<input type="hidden" name="projLogo"></div>
							<span class="dn_ico dn_ico_seek_pur2"></span>上传logos
						</div>
						<span class="tit_span" id="projLogoName">请上传项目logo，建议图片尺寸300*300 文件大小请限制在500k内</span>
					</div>
				</li>
				<li class="seek_show_on">
					<div class="seek_financing_l"><span class="seek_financing_two">所属领域</span></div>
					<input type="hidden" name="projIndustry">
					<input type="hidden" name="projSubIndustry">
					<div class="seek_financing_r">
						<select class="seek_financing_select" name="projIndustryId" data-item="parent" data-field="industry" >
							<option  selected= "selected" disabled="true" >选择一级行业</option>
						</select>
						<select class="seek_financing_select seek_financing_select_lef" name="projSubIndustryId" data-item="son" >
							<option  selected= "selected" disabled="true" >选择二级行业</option>
						</select>
					</div>
				</li>
				<li class="seek_show_on">
					<div class="seek_financing_l"><span class="seek_financing_two">产品网址</span></div>
					<div class="seek_financing_r">
						<input class="seek_financing_input" name="projWebaddress" placeholder="产品网址" data-rule-url="true" data-msg-url="<font color=red>*</font>网址格式不正确">
					</div>
				</li>
				<li class="seek_show_on">
					<div class="seek_financing_l"><span class="seek_financing_two">公司全称</span></div>
					<div class="seek_financing_r">
						<input class="seek_financing_input" name="projCompName" maxlength="40" placeholder="请输入工商注册公司全称，不超过40个字">
					</div>
				</li>
				<li class="seek_show_on">
					<div class="seek_financing_l"><span class="seek_financing_two">公司地址</span></div>
					<div class="seek_financing_r">
						<input class="seek_financing_input" name="projCompAddr"  maxlength="500"   placeholder="公司地址">
					</div>
				</li>
				<li class="seek_show_on">
					<div class="seek_financing_l"><span class="seek_financing_two">融资轮次</span></div>
					<input type="hidden" name="projRound">
					<div class="seek_financing_r">
						<select class="seek_financing_select" name="projRoundId"  data-item="parent" data-field="round" >
							<option  selected= "selected" disabled="true" >选择融资轮次</option>
						</select>
					</div>
				</li>
				<li class="seek_show_on">
					<div class="seek_financing_l"><span class="seek_financing_two">融资金额</span></div>
					<div class="seek_financing_r">
						<input class="seek_financing_input" name="projMoney" placeholder="请输入您需要的融资金额"  data-rule-money="true" data-msg-money="请输入数字，最多可填写4位小数">
						<div class="seek_financing_absolute">万元　(人民币)</div>
					</div>
				</li>
				<li class="seek_show_on">
					<div class="seek_financing_l"><span class="seek_financing_two">出让股份</span></div>
					<div class="seek_financing_r">
						<input class="seek_financing_input" name="projStock" placeholder="请输入出让的股份（百分比）" data-rule-stock="true" data-msg-stock="请输入0-100之间的数字，最多可填写4位小数" >
						<div class="seek_financing_absolute">%</div>
					</div>
				</li>
			</ul>
			<div class="seek_show"><span class="seek_show_open"><span class="seek_show_blue">完善信息　</span>可以加速融资进度哦~<span class="dn_ico dn_ico_seek_open"></span></span><span class="seek_show_off"><span class="seek_show_blue">收起</span><span class="dn_ico dn_ico_seek_off"></span></span></div>
			<div class="seek_submit" id="save-btn">提交项目</div>
		</div>
	</form>
</div>
{(dn_foot.html)}
</body>
<script src="js/jquery.validate.js" type="text/javascript"></script>
<script src="js/messages_zh.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/jquery.ui.widget.js"></script>
<script type="text/javascript" src="js/jquery.fileupload.js"></script>
<script type="text/javascript" src="js/jquery.fileupload-validate.js"></script>
<script>
	$(function(){
		//jquery.validate
		$("#form").validate({
			submitHandler: function() {
				var pb = $("input[name='projPb']").val();
				if(!pb){
					$("#projPbName").text("<font color=red>*</font>请上传文件")
					return;
				}
				save()
				//验证通过后 的js代码写在这里
			}
		})

	})
	//验证手机号
    jQuery.validator.addMethod("phone", function (value, element) {
     var phone = /^[\+\-\(\)0-9]{0,40}$/;
   	return this.optional(element) || (phone.test(value));
    }, "手机格式不对");

	//验证长度
	jQuery.validator.addMethod("length20", function (value, element) {
		var verify_20 = /^(?!.{20}|^\s*$)/;
		return this.optional(element) || (verify_20.test(value));
	}, "");
	
	//验证长度
	jQuery.validator.addMethod("length50", function (value, element) {
		var verify_50 = /^(?!.{50}|^\s*$)/;
		return this.optional(element) || (verify_50.test(value));
	}, "");
	//验证长度
	jQuery.validator.addMethod("length1000", function (value, element) {
		var verify_1000 = /^(?!.{50}|^\s*$)/;
		return this.optional(element) || (verify_1000.test(value));
	}, "");

	//验证select
	jQuery.validator.addMethod("select", function (value, element) {
		if(!value){
			return false;
		}else{
			return true;
		}
	}, "");


	//验证长度
	jQuery.validator.addMethod("url", function (value, element) {
		var regex = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/;
		return this.optional(element) || (regex.test(value));
	}, "");


	//验证长度
	jQuery.validator.addMethod("money", function (value, element) {
		var regex = /^([1-9]\d{0,7}|0)(\.\d{1,4})?$/;
		return this.optional(element) || (regex.test(value));
	}, "");

	//验证长度
	jQuery.validator.addMethod("stock", function (value, element) {
		var regex = /^([1-9]\d{0,2}|0)(\.\d{1,4})?$/;
		return this.optional(element) || (regex.test(value));
	}, "");

	$.fn.serializeJson = function(){
		var data = {};
		var array = this.serializeArray();
		$.each(array,function(){
			data[this.name]=this.value.replace(/(^\s+)|(\s+$)/g,"");
		})
		return data;
	}

	$('.seek_show_open').click(function(event){
		$(this).hide();
		$('.seek_show_on').show();
		$('.seek_show_off').show();
	})
	$('.seek_show_off').click(function(event){
		$(this).hide();
		$('.seek_show_on').hide();
		$('.seek_show_open').show();
	})

	$("#projLogo").fileupload({
		url:platformUrl.fileUpload,
		formData:{},
		add: function (e, data) {
			var acceptFileTypes = /\/(jpg|jpeg|png|gif)$/i;
			if(data.originalFiles[0]['type'].length && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
				$("#projLogoName").text("<font color=red>*</font>您的文件格式不正确")
				return;
			}
			if(data.files[0].size > 500*1024){
				$("#projLogoName").text("<font color=red>*</font>您的文件大小超过限制，请控制在500KB之内")
				return;
			}
			$("#projLogoName").val(data.files[0].name);
            data.submit();
        },
        messages: {
			maxFileSize: 'File exceeds maximum allowed size of 5b'
		},
		done: function (e, data) {
			if(data.result.message == 'OK')
			{
				$("input[name='projLogo']").val(data.result.data)
			}
			else
			{
				$("#projLogoName").text(data.result.message);
			}
		},
		always:function(e,data){
			$("#save-btn").attr("disabled",true)
		}
	});
	$("#projPb").fileupload({
		url:platformUrl.fileUpload,
		formData:{},
		add: function (e, data) {
			if(data.files[0].size > 25*1024*1024){
				$("#projPbName").text("<font color=red>*</font>您的文件大小超过限制，请控制在25M之内")
				return;
			}
			$("#projPbName").text(data.files[0].name);
            data.submit();
        },
		done: function (e, data) {
			if(data.result.message == 'OK')
			{
				$("input[name='projPb']").val(data.result.data)
			}
			else
			{
				$("#projPbName").text(data.result.message);
			}
		},
		always:function(e,data){
				$("#save-btn").attr("disabled",true)
		}
	});



</script>
<script>


function save(){
		var projDistrict =  $("select[name='projDistrictId']").find("option:selected").text();
		var projSubDistrict =  $("select[name='projSubDistrictId']").find("option:selected").text();
		var projIndustry =  $("select[name='projIndustryId']").find("option:selected").text();
		var projSubIndustry =  $("select[name='projSubIndustryId']").find("option:selected").text();
		var projRound =  $("select[name='projRoundId']").find("option:selected").text();

		$("input[name='projDistrict']").val(projDistrict)
		$("input[name='projSubDistrict']").val(projSubDistrict)
		$("input[name='projIndustry']").val(projIndustry)
		$("input[name='projSubIndustry']").val(projSubIndustry)
		$("input[name='projRound']").val(projRound)

		var url =detail.insertProject
			var data = JSON.stringify($("#form").serializeJson());
			$.ajax({
				type: "POST",
				url:url,
				contentType:'application/json;charset=UTF-8',
				data:data,
				success:function(data){
					if(data.message == 'OK')
					{
						alert('保存成功');
					}
					else
					{
						alert(data.message);
					}
				}
			})
}
$("#save-btn").click(function(event){

	$("#form").submit();
})
	<!--$("#save-btn").click(function(event){-->
		<!--event.preventDefault();-->
		<!--var projDistrict =  $("select[name='projDistrictId']").find("option:selected").text();-->
		<!--var projSubDistrict =  $("select[name='projSubDistrictId']").find("option:selected").text();-->
		<!--var projIndustry =  $("select[name='projIndustryId']").find("option:selected").text();-->
		<!--var projSubIndustry =  $("select[name='projSubIndustryId']").find("option:selected").text();-->
		<!--var projRound =  $("select[name='projRoundId']").find("option:selected").text();-->

		<!--$("input[name='projDistrict']").val(projDistrict)-->
		<!--$("input[name='projSubDistrict']").val(projSubDistrict)-->
		<!--$("input[name='projIndustry']").val(projIndustry)-->
		<!--$("input[name='projSubIndustry']").val(projSubIndustry)-->
		<!--$("input[name='projRound']").val(projRound)-->

		<!--if($("#form").validate().form())-->
		<!--{-->
			<!--var url =detail.insertProject-->
			<!--var data = JSON.stringify($("#form").serializeJson());-->
			<!--$.ajax({-->
				<!--type: "POST",-->
				<!--url:url,-->
				<!--contentType:'application/json;charset=UTF-8',-->
				<!--data:data,-->
				<!--success:function(data){-->
					<!--if(data.message == 'OK')-->
					<!--{-->
						<!--alert('保存成功');-->
					<!--}-->
					<!--else-->
					<!--{-->
						<!--alert(data.message);-->
					<!--}-->
				<!--}-->
			<!--})-->
		<!--}-->
	<!--});-->

	var list ={} ;
	sendGetRequest(platformUrl.allQuery,function(data){
		list["district"] = data.data.district[0].children;
		list["industry"] = data.data.industry;
		list["round"] = data.data.round;
	})
	var parents = $("select[data-item='parent']");
	$.each(parents,function(){
		var parent = $(this);
		var field =  parent.attr("data-field");
		var data  = list[field];
		var html = ""
		$.each(data,function(i,e){
			html += "<option value ="+e.id+" >"+e.name+"</option>"
		})
		parent.append(html);
	})

	$.each(parents,function(){
		var parent = $(this);
		parent.change(function(){
			var son =parent.next()
			 // 先清空第二个
			son.empty();
			//var id =parent.val();
			var field=parent.attr("data-field")
			var data =list[field][(parent[0].selectedIndex)-1].children;
			var html = ""
			$.each(data,function(i,e){
				html += "<option value ="+e.id+" >"+e.name+"</option>"
			})
			son.append(html);
		})
	});
</script>
</html>
