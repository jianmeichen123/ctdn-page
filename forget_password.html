<!doctype html>
<html>
<head>
	<meta charset="utf-8"></meta>
	<title>找回密码</title>
	<!--basis-->
	{(dn_basis.html)}
</head>
<body>
{(header.html)}
<div class='login'>
<div class='login-left'><img src='../img/login/login_03.jpg'/></div>
	<!-- 密码登录 -->
	<div class='login-right'>
		<!--找回密码  -->
		<div class='login-right-content '>
		<ul class='find-pass-title'>
			<span>找回密码</span>
		</ul>
			<input class='login-input input-first telphone' type='text' placeholder='请输入登录用户名/手机号' id="mobile" maxlength="11"  onfocus="func_focus(this)"/><label class='login-tips' id="mobile_tip">*你输入的手机号格式不正确</label>
			<input class='login-input input-code' type='text' placeholder='请输入验证码' id="code" maxlength="6"  onfocus="func_focus(this)"/>
				<span class='login-send-code' id="find_code" onclick="send_code(this,'2')">发送验证码</span>
				<label class='login-tips' id="code_tip">*你输入的手机号格式不正确</label>
			<span class='eye-box'><input class='login-input input-last' type='password' placeholder='请重新设置登录密码' id="password"  onfocus="func_focus(this)" maxlength="30"/><label class='login-tips' id="password_tip">*你输入的手机号格式不正确</label><span class='login-eye' id="password_eye"></span></span>
			<span class='eye-box'><input class='login-input input-last' type='password' placeholder='请再次输入登录密码' id="confirmPassword"  onfocus="func_focus(this)" maxlength="30"/><label class='login-tips' id="confirmPassword_tip">*你输入的手机号格式不正确</label><span class='login-eye' id="confirmpassword_eye"></span></span>
			<span class='to-login' onclick="find_password()">重置密码</span>
			<ul class='find-pass-bottom'>
				<li class='to-login-page' onclick="login_page()">登录</li>
				<li class='find-pass-middle'><img src='../img/login/line_03.jpg'/></li>
				<li class='to-register-page' onclick="register_page()">注册</li>
			</ul>
		</div>
		
	</div>
</div>






<!-- {(dn_foot.html)} -->
</body>
<script src="/js/common.js"></script>
<script src="/js/base64.js"></script>
<script src="/js/find_password.js"></script>
<script>
// $('.find-back-pass').show();
var exists_flag = false
function find_password(){
	$('.login-tips').css('display','none')
    $("input").removeClass('inputDanger');
    $("input").removeClass('invalid');
	var mobile = $("#mobile").val();
	if(mobile== null || mobile.trim().length == 0)
	{
		$("#mobile").addClass('inputDanger');
		$("#mobile").addClass('invalid');
		$('#mobile_tip').css('display','block').html('请输入登录手机号');
		return;
	}
	if(!/^1[0-9]{10}$/.test(mobile))
	{
		$("#mobile").addClass('inputDanger');
		$("#mobile").addClass('invalid');
		$("#mobile_tip").css('display','block').html('请输入有效手机号码');
		return;
	}
    sendPostRequestByJsonObj(platformUrl.checkUserExists,{"mobile":mobile},function(data){
    	if(data.result.status == 'OK'){
    		exists_flag= data.entity.exists
    	}else{
    		layer.msg(data.result.message)
    	}
    });
    if(!exists_flag){
    	$("#mobile").addClass('inputDanger');
    	$("#mobile").addClass('invalid');
    	layer.msg('您输入账号不存在~')
    	return
    }
	var code = $('#code').val()
	if(!code){
		$("#code").addClass('inputDanger');
		$("#code").addClass('invalid');
		$('#code_tip').css('display','block').html("请输入验证码");
		return
	}
    sendPostRequestByJsonObj(platformUrl.checkCode,{"mobile":mobile,"code":code,"type":"2"},function(data){
    	if(data.result.status == 'OK'){
    		exists_flag= true
    	}else{
    		exists_flag = false
    		layer.msg(data.result.message)
    	}
    });
    if(!exists_flag){
    	$("#code").addClass('inputDanger');
		$("#code").addClass('invalid');
		layer.msg('验证码错误~')
		return
    }
	var password = $('#password').val()

	if(password == null || $.trim(password).length == 0){
		$("#password").addClass('inputDanger');
		$("#password").addClass('invalid');
		$('#password_tip').css('display','block').html("请输入登录密码");
		return
	}
	if(!/^[0-9a-zA-Z]{6,30}$/.test(password)){
		$("#password").addClass('inputDanger');
		$("#password").addClass('invalid');
		$('#password_tip').css('display','block').html("请输入6-30位的数字或字母作为密码~");
		layer.msg('请输入6-30位的数字或字母作为密码~')
		return
	}
	var confirmPassword = $('#confirmPassword').val()
	if(confirmPassword == null ||  $.trim(confirmPassword).length  == 0){
		$("#confirmPassword").addClass('inputDanger');
		$("#confirmPassword").addClass('invalid');
		$('#confirmPassword_tip').css('display','block').html("请再次输入登录密码");
		return
	}
	if(password != confirmPassword){
		$("#password").addClass('inputDanger');
		$("#password").addClass('invalid');
		$("#confirmPassword").addClass('inputDanger');
		$("#confirmPassword").addClass('invalid');
		layer.msg('两次密码输入不一致~')
		return
	}
	var jsonData = {"mobile" : mobile,"code":code,"password":password,"confirmPassword":confirmPassword}
	sendPostRequestByJsonObj(platformUrl.updatePassword,jsonData,findPasswordcallback);
}
function findPasswordcallback(data){
	if(data.result.status=="OK"){
		window.location.href = platformUrl.toLogin
	 }else{
		 var code = data.result.errorCode
		 if(code == '1'){
			$("#mobile").addClass('inputDanger');
			$("#moible").addClass('invalid');
		 }
		 if(code == '2'){
			$("#code").addClass('inputDanger');
			$("#code").addClass('invalid');
		 } 
	     layer.msg(data.result.message)
	 }
}
</script>

</html>